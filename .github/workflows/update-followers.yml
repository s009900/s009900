name: Update Followers List

on:
  schedule:
    # Runs every 6 hours
    - cron: '0 */6 * * *'
  workflow_dispatch:  # Allows manual triggering

jobs:
  update-followers:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Update Followers in README
        uses: actions/github-script@v6
        with:
          script: |
            const { data: followers } = await github.rest.users.listFollowersForUser({
              username: 's009900',  // Your GitHub username
              per_page: 5,          // Get 5 most recent followers
              headers: {
                'X-GitHub-Api-Version': '2022-11-28'
              }
            });
            
            // Generate the followers table
            let followersTable = '| # | Avatar | Username |\n|---|--------|----------|\n';
            
            if (followers.length > 0) {
              followers.forEach((follower, index) => {
                followersTable += `| ${index + 1} | <img src="${follower.avatar_url}" width="24" /> | [${follower.login}](https://github.com/${follower.login}) |\n`;
              });
            } else {
              followersTable = 'No followers yet. Be the first!';
            }
            
            // Read the current README
            const fs = require('fs');
            let readme = fs.readFileSync('README.md', 'utf8');
            
            // Update the followers section between the markers
            const startMarker = '<!-- followers:start -->';
            const endMarker = '<!-- followers:end -->';
            const newContent = `${startMarker}\n${followersTable}\n${endMarker}`;
            
            const updatedReadme = readme.replace(
              new RegExp(`${startMarker}[\s\S]*?${endMarker}`),
              newContent
            );
            
            // Write the updated README
            fs.writeFileSync('README.md', updatedReadme);
            
      - name: Commit and push changes
        run: |
          git config --global user.name 'GitHub Action'
          git config --global user.email 'action@github.com'
          git add README.md
          git diff --quiet && git diff --staged --quiet || \
            (git commit -m 'Update followers list' && git push)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
