name: Update Followers List

on:
  schedule:
    # Runs daily at 00:00 UTC
    - cron: '0 0 * * *'
  workflow_dispatch:

jobs:
  update-followers:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Update Followers
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { data: followers } = await github.rest.users.listFollowersForUser({
              username: 's009900',
              per_page: 4,
              headers: {'X-GitHub-Api-Version': '2022-11-28'}
            });

            let tableContent = `| # | Avatar | Username |\n|--:|:------:|:---------|\n`;
            followers.forEach((follower, index) => {
              tableContent += `| ${index+1} | <img src="${follower.avatar_url}" width="50" height="50" /> | [@${follower.login}](${follower.html_url}) |\n`;
            });

            const content = [
              '## ðŸ‘¥ Recent Followers',
              `_Last updated: ${new Date().toUTCString()}_`,
              '',
              tableContent,
              '_âœ¨ Updated daily via GitHub Actions_'
            ].join('\n');

            fs.writeFileSync('followers.md', content);

      - name: Commit & Push
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add followers.md
          git commit -m "Update followers list" || echo "No changes to commit"
          git push